<?xml version="1.0" encoding="utf-8" ?>
<ContentPage 
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    x:Class="StockWise.Client.Paginas.ProductosPage"
    BackgroundColor="#0A0F1C">

    <!-- GRID PRINCIPAL -->
    <Grid RowDefinitions="Auto, Auto, Auto, *, Auto, Auto, Auto">

        <!-- ================================================================= -->
        <!-- ðŸ”¥ FILA 0: HEADER -->
        <!-- ================================================================= -->
        <Grid Grid.Row="0"
              ColumnDefinitions="Auto, *"
              Padding="15,20">

            <!-- BotÃ³n hamburguesa -->
            <Frame Padding="5"
                   BackgroundColor="Transparent"
                   HasShadow="False"
                   HorizontalOptions="Start"
                   VerticalOptions="Center">

                <Label Text="â˜°"
                       FontSize="32"
                       TextColor="White">
                    <Label.GestureRecognizers>
                        <TapGestureRecognizer Tapped="OnMenuToggleClicked"/>
                    </Label.GestureRecognizers>
                </Label>

            </Frame>

            <Label Grid.Column="1"
                   Text="QRStock - Productos"
                   HorizontalOptions="Center"
                   VerticalOptions="Center"
                   FontSize="22"
                   FontAttributes="Bold"
                   TextColor="#4EE1A0"/>
        </Grid>



        <!-- ================================================================= -->
        <!-- ðŸ”¥ FILA 1: MENÃš DESPLEGABLE -->
        <!-- ================================================================= -->
        <StackLayout x:Name="MenuContainer"
             Grid.Row="1"
             Padding="10"
             BackgroundColor="#121A2A"
             WidthRequest="200"
             Opacity="0.92"
             IsVisible="False"
             HorizontalOptions="Start"
             VerticalOptions="Start"
             Margin="15,10,0,0"
             Spacing="10">

            <Grid ColumnDefinitions="Auto">
                <Button Text="ðŸ‘¤ Mi perfil"
                        BackgroundColor="#1E2A44"
                        TextColor="White"
                        CornerRadius="10"
                        HeightRequest="40"
                        WidthRequest="170"
                        HorizontalOptions="Start"
                        Clicked="OnPerfilClicked"/>
            </Grid>
            
            <Grid ColumnDefinitions="Auto">
                <Button Text="ðŸ¢ Editar empresa"
                BackgroundColor="#1E2A44"
                TextColor="White"
                CornerRadius="10"
                HeightRequest="40"
                WidthRequest="170"
                HorizontalOptions="Start"
                x:Name="BtnEditarEmpresa"
                Clicked="OnEditarEmpresaClicked"/>
            </Grid>
            
            <Grid ColumnDefinitions="Auto">
                <Button Text="ðŸ‘¥ Usuarios (Admin)"
                        BackgroundColor="#1E2A44"
                        TextColor="White"
                        CornerRadius="10"
                        HeightRequest="40"
                        WidthRequest="170"
                        HorizontalOptions="Start"
                        x:Name="BtnAdmin"
                        Clicked="OnAdminClicked"/>
            </Grid>

            <Grid ColumnDefinitions="Auto">
                <Button Text="ðŸšª Cerrar sesiÃ³n"
                        BackgroundColor="#c62828"
                        TextColor="White"
                        CornerRadius="10"
                        HeightRequest="40"
                        WidthRequest="170"
                        HorizontalOptions="Start"
                        Clicked="OnLogoutClicked"/>
            </Grid>

        </StackLayout>



        <!-- ================================================================= -->
        <!-- ðŸ”¥ FILA 2: BOTÃ“N AÃ‘ADIR PRODUCTO -->
        <!-- ================================================================= -->
        <Button x:Name="BtnCrearProducto"
                Grid.Row="2"
                Text="+ AÃ±adir producto"
                BackgroundColor="#4EE1A0"
                TextColor="#0A0F1C"
                FontAttributes="Bold"
                CornerRadius="15"
                HeightRequest="45"
                Margin="20,10"
                Clicked="OnCrearProductoClicked"/>



        <!-- ================================================================= -->
        <!-- ðŸ”¥ FILA 3: LISTA DE PRODUCTOS -->
        <!-- ================================================================= -->
        <Grid Grid.Row="3" Padding="20">

            <CollectionView x:Name="ProductosList"
                            IsVisible="False"
                            SelectionMode="Single"
                            SelectionChanged="ProductosList_SelectionChanged">

                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Frame CornerRadius="12"
                               Margin="0,8"
                               Padding="12"
                               BackgroundColor="#121A2A"
                               BorderColor="#1E2A44"
                               HasShadow="True">

                            <Grid ColumnDefinitions="*,Auto">

                                <VerticalStackLayout>
                                    <Label Text="{Binding Nombre}" FontSize="18" FontAttributes="Bold" TextColor="White"/>
                                    <Label Text="{Binding Proveedor}" FontSize="14" TextColor="#7DA0C0"/>
                                    <Label Text="Cantidad:" FontSize="13" TextColor="#4EE1A0" FontAttributes="Bold"/>
                                    <Label Text="{Binding Cantidad}" FontSize="13" TextColor="#4EE1A0"/>
                                </VerticalStackLayout>

                                <Label Grid.Column="1"
                                       Text="{Binding Precio, StringFormat='â‚¬{0:F2}'}"
                                       FontSize="16"
                                       FontAttributes="Bold"
                                       VerticalOptions="Center"
                                       TextColor="#4EE1A0"/>
                            </Grid>

                        </Frame>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>

            <StackLayout x:Name="EmptyState"
                         IsVisible="False"
                         VerticalOptions="Center"
                         HorizontalOptions="Center">

                <Image Source="empty.png" HeightRequest="150" Opacity="0.8"/>
                <Label Text="No hay productos disponibles"
                       FontSize="16"
                       TextColor="#7DA0C0"
                       HorizontalOptions="Center"/>
            </StackLayout>

            <ActivityIndicator x:Name="LoadingIndicator"
                               IsVisible="False"
                               HorizontalOptions="Center"
                               VerticalOptions="Center"
                               Color="#4EE1A0"/>
        </Grid>



        <!-- ================================================================= -->
        <!-- ðŸ”¥ FILA 4: BOTÃ“N IMPORTAR CSV -->
        <!-- ================================================================= -->
        <Button Grid.Row="4"
                Text="ðŸ“¦ Importar CSV"
                BackgroundColor="#4EE1A0"
                TextColor="#0A0F1C"
                FontAttributes="Bold"
                HeightRequest="48"
                CornerRadius="18"
                Margin="20,10"
                x:Name="BtnImportar"
                Clicked="OnImportarClicked"/>


        <!-- ================================================================= -->
        <!-- ðŸ”¥ FILA 5: BOTÃ“N EXPORTAR CSV -->
        <!-- ================================================================= -->
        <Button Grid.Row="5"
        Text="ðŸ“¤ Exportar CSV"
        BackgroundColor="#4EE1A0"
        TextColor="#0A0F1C"
        FontAttributes="Bold"
        HeightRequest="48"
        CornerRadius="18"
        Margin="20,0,20,10"
        x:Name="BtnExportar"
        Clicked="OnExportarClicked"/>

        <!-- ================================================================= -->
        <!-- ðŸ”¥ FILA 6: BOTÃ“N ESCANEAR QR -->
        <!-- ================================================================= -->
        <Button Grid.Row="6"
                Text="ðŸ“· Escanear QR"
                BackgroundColor="#4EE1A0"
                TextColor="#0A0F1C"
                FontAttributes="Bold"
                HeightRequest="48"
                CornerRadius="18"
                Margin="20,0,20,20"
                Clicked="AbrirLectorQR"/>

    </Grid>
</ContentPage>
